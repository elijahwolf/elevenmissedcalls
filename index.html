<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>missed calls</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <style>
    @media (prefers-reduced-motion: reduce) {
      body {
        background-image: none !important;
        background-color: #000 !important;
      }
    }
  </style>
</head>
<body>
  <h1 class="title">missed calls</h1>

  <div class="window">
    <div class="number">
      <a href="tel:12066595565"><strong>(206)-659-5565</strong></a>
    </div>

    <p>leave an anonymous voicemail.</p>
    <p>no names.</p>
    <p>no pressure.</p>
    <p>just say it.</p>
    <p class="tagline">we're listening.<span class="cursor">_</span></p>

    <p class="shared-label">some messages will be shared anonymously on</p>
    <p class="social-links">
      <a href="https://www.tiktok.com/@elevenmissedcalls" target="_blank">TikTok</a>
    </p>

    <div class="footer">powered by what you didn't say â€¢ est. 2023</div>
  </div>

  <div class="recorder">
    <h2 class="record-title">or record your own message</h2>
    <button id="startBtn">Start Recording</button>
    <button id="stopBtn" disabled>Stop</button>
    <audio id="player" controls style="display: none;"></audio>
    <button id="sendBtn" disabled>Send</button>
    <p class="note">recordings are anonymous and capped at 90 seconds.</p>
  </div>

  <div class="mic-indicator" id="micIndicator">
    <span class="mic-dot"></span> recording...
  </div>

  <script>
    let mediaRecorder;
    let audioChunks = [];
    let recordTimeout;
  
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const sendBtn = document.getElementById('sendBtn');
    const player = document.getElementById('player');
    const micIndicator = document.getElementById('micIndicator');
  
    startBtn.onclick = async () => {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
  
        const mimeType = MediaRecorder.isTypeSupported('audio/webm')
          ? 'audio/webm'
          : 'audio/mp4';
  
        mediaRecorder = new MediaRecorder(stream, { mimeType });
        audioChunks = [];
  
        mediaRecorder.ondataavailable = (event) => {
          if (event.data.size > 0) {
            audioChunks.push(event.data);
          }
        };
  
        mediaRecorder.onstop = () => {
          clearTimeout(recordTimeout);
          micIndicator.style.display = 'none';
  
          if (audioChunks.length === 0) {
            alert('No audio captured.');
            return;
          }
  
          const audioBlob = new Blob(audioChunks, { type: mimeType });
          const audioURL = URL.createObjectURL(audioBlob);
  
          player.src = audioURL;
          player.style.display = 'block';
          sendBtn.disabled = false;
        };
  
        mediaRecorder.start();
        startBtn.disabled = true;
        stopBtn.disabled = false;
        sendBtn.disabled = true;
        micIndicator.style.display = 'block';
  
        // Auto-stop after 90 seconds
        recordTimeout = setTimeout(() => {
          if (mediaRecorder && mediaRecorder.state === 'recording') {
            mediaRecorder.stop();
          }
        }, 90000); // 90,000ms = 90 seconds
  
      } catch (err) {
        alert('Microphone access error: ' + err.message);
      }
    };
  
    stopBtn.onclick = () => {
      if (mediaRecorder && mediaRecorder.state === 'recording') {
        mediaRecorder.stop();
        stopBtn.disabled = true;
        startBtn.disabled = false;
      }
    };
  
    sendBtn.onclick = () => {
      alert('Uploading not implemented yet. This will be saved in the future backend.');
    };
  </script>
</body>
</html>
